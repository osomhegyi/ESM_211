<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>portfolio_6_fsa</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Portfolio_6_FSA_files/libs/clipboard/clipboard.min.js"></script>
<script src="Portfolio_6_FSA_files/libs/quarto-html/quarto.js"></script>
<script src="Portfolio_6_FSA_files/libs/quarto-html/popper.min.js"></script>
<script src="Portfolio_6_FSA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Portfolio_6_FSA_files/libs/quarto-html/anchor.min.js"></script>
<link href="Portfolio_6_FSA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Portfolio_6_FSA_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Portfolio_6_FSA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Portfolio_6_FSA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Portfolio_6_FSA_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="portfolio-6---fsa" class="level1">
<h1>Portfolio 6 - FSA</h1>
<p>FSA - Fisheries Stock Assessment Package</p>
<p>What does it do? A variety of fish stock stuff. Incorporates many simple tasks</p>
<ul>
<li><p>age comparisons - age-length relationships - size structures - weight-length relationships (WrAdd) - Abundance from capture-recapture - Depletion methods for estimating abundance - morality rates - growth rates - catch curve estimates of mortality(catch curve)</p></li>
<li><p>Fisheries managers want to assess the health of a fish population and its environmnet for management</p></li>
<li><p>Uses weight to length data to calculate habitat quality (i think)</p></li>
<li><p>Fish &lt; 8cm can’t be used in the calculation</p></li>
</ul>
<p>Catch curve overview - Linear Regression Basis - Data needed to put into catch curve: Data and Catch (need to be numeric)</p>
<p>Depletion Model Overview - It estimates the total population size for a closed population - Many different methods –&gt; Leslie Method, DeLury Method, K-Pass - DeLury Method: Use this method when the fraction of the stock removed by unit of fishing effort is really small (&lt; 2%) - K-Pass Method: Just need data on the number that are captured</p>
<section id="portfolio-assignment" class="level2">
<h2 class="anchored" data-anchor-id="portfolio-assignment">Portfolio Assignment:</h2>
<p>Portfolio assignment questions are at the end of the CatchCurve and the Depletion function sections. There is not a portfolio assignment with the Weight-Length example, but the code is here if you want to try it! There are a total of four questions.</p>
</section>
<section id="load-in-the-necessary-pacakges-for-all-three-examples" class="level2">
<h2 class="anchored" data-anchor-id="load-in-the-necessary-pacakges-for-all-three-examples">Load in the necessary pacakges for all three examples</h2>
<section id="section" class="level61">
<p class="heading"></p>
</section>
</section>
<section id="weight-length-example" class="level2">
<h2 class="anchored" data-anchor-id="weight-length-example">Weight-length example</h2>
<p>load in the data, which comes from the FSAdata package above</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(InchLake2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>clean data for example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's look at the Bluegill data, which was a catch and release sample from a lake in Wisconsin. </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#this data has fish length in inches and weight in grams. recall for relative weights you need to be fully in  english or metric units. </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#convert lengths to mm in a new column called length_mm</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>InchLake2<span class="sc">$</span>length_mm <span class="ot">&lt;-</span> <span class="fu">round</span>(InchLake2<span class="sc">$</span>length<span class="sc">*</span><span class="fl">25.4</span>,<span class="dv">0</span>) </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#look specifically at Bluegill fish, and from the year 2007, to get a snapshot of how the population was doing at that particular time</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>bluegill_2007 <span class="ot">&lt;-</span> InchLake2 <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"Bluegill"</span>, year <span class="sc">==</span> <span class="st">"2007"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>compute relative weight using wrAdd(),</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can manually compute relative weight (see the vignette for that), but FSA gives you a tool to do that more easily: </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#wrAdd() calculates the relative weight for each fish based on the standard weight equation for that species </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>bluegill_2007_weights <span class="ot">&lt;-</span> <span class="fu">wrAdd</span>(weight<span class="sc">~</span>length_mm<span class="sc">+</span>species, <span class="at">data=</span>bluegill_2007) <span class="co">#calculates relative weight </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#add to the dataframe </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>bluegill_2007 <span class="ot">&lt;-</span> bluegill_2007 <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">relative_weight =</span> bluegill_2007_weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>interpret what the relative weights mean</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>wr_2007 <span class="ot">&lt;-</span> <span class="fu">mean</span>(bluegill_2007<span class="sc">$</span>relative_weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>wr_2007</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 88.66777</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#relative weight below 100 indicates the fish/population is skinnier than expected for that species, indicating a potentially unhealthy population and environmental conditions that aren't favorable </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#relative weight above 100 indicates the fish/population is fatter than expected for that species, indicating a healthy population and favorable environmental conditions </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>find the average relative weight by size class</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for bluegill research groups them into the following classes: </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;8 cm </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;15 cm</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;20 cm</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;25 cm </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;30 cm </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#approximate length at maturity for bluegill is 15cm, so the first two size classes are juveniles </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#categorize each fish into its size class </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>bluegill_2007 <span class="ot">&lt;-</span> bluegill_2007 <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">ifelse</span>(length_mm <span class="sc">&lt;</span> <span class="dv">80</span>, <span class="st">"young_of_year"</span>, <span class="fu">ifelse</span>(length_mm <span class="sc">&lt;</span> <span class="dv">150</span>, <span class="st">"juvenile"</span>, <span class="fu">ifelse</span>(length_mm <span class="sc">&lt;</span> <span class="dv">200</span>, <span class="st">"adult_1"</span>, <span class="fu">ifelse</span>(length_mm <span class="sc">&lt;</span> <span class="dv">250</span>, <span class="st">"adult_2"</span>, <span class="st">"adult_3"</span>)))))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#the relative weight function doesn't work for fish in the young of year class for this species (they're too short), so we can compare juveniles to different classes of adults </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>bluegill_2007_summary <span class="ot">&lt;-</span> bluegill_2007 <span class="sc">%&gt;%</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_relative_weight =</span> <span class="fu">mean</span>(relative_weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>bluegill_2007_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  class         mean_relative_weight
  &lt;chr&gt;                        &lt;dbl&gt;
1 adult_1                       89.8
2 adult_2                       96.1
3 juvenile                      79.5
4 young_of_year                NaN  </code></pre>
</div>
</div>
<section id="section-1" class="level70">
<p class="heading"></p>
</section>
</section>
<section id="catchcurve-example" class="level2">
<h2 class="anchored" data-anchor-id="catchcurve-example">CatchCurve example</h2>
<p>let’s grab the data and process it!</p>
<p>We need a dataframe that contains age and catch (both are numerics)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#can use this function from FSAdata to find data that is compatible with the function</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help.search</span>(<span class="st">"Catch curve"</span>, <span class="at">package=</span><span class="fu">c</span>(<span class="st">"FSAdata"</span>,<span class="st">"FSA"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#we are going to use data of estimated catch-at-age for Gulf Menhaden from 1964-2004</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>FSAdata<span class="sc">::</span>Menhaden1 <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pivot the data to get it in the required format</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> age0<span class="sc">:</span>age6, <span class="at">names_to =</span> <span class="st">"age"</span>, <span class="at">values_to =</span> <span class="st">"ct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#then use group by and summarize to get one total catch value by age class</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">catch=</span><span class="fu">sum</span>(ct))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#use string manipulations to remove the leading age_ from the values in the age column</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>age<span class="ot">&lt;-</span><span class="fu">str_replace_all</span>(data<span class="sc">$</span>age, <span class="st">"age"</span>, <span class="st">""</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#convert columns to numerics</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>age<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(data<span class="sc">$</span>age)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#take the log of catch</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logct <span class="ot">&lt;-</span> <span class="fu">log</span>(data<span class="sc">$</span>catch)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#examine the structure of the dataframe</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [7 × 3] (S3: tbl_df/tbl/data.frame)
 $ age  : num [1:7] 0 1 2 3 4 5 6
 $ catch: num [1:7] 502 161220 90815 9419 708 ...
 $ logct: num [1:7] 6.22 11.99 11.42 9.15 6.56 ...</code></pre>
</div>
</div>
<p>Plot the catch curve for this data to assess which ages fall on the descending limb of the catch curve.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logct<span class="sc">~</span>age,<span class="at">data=</span>data,<span class="at">ylab=</span><span class="st">"log(Catch)"</span>,<span class="at">pch=</span><span class="dv">19</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Portfolio_6_FSA_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Non-weighted regression</p>
<p>Now, you can use this information in the catchCurve function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we will use years 1-6</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> FSA<span class="sc">::</span><span class="fu">catchCurve</span>(catch<span class="sc">~</span>age,<span class="at">data=</span>data,<span class="at">ages2use=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#show the estimated values of Z and A (and std. deviation)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Z is the instantaneous mortality rate (think slope of line)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#A is the annual mortality rate</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Estimate Std. Error  t value     Pr(&gt;|t|)
Z  2.287001  0.1883957 12.13935 0.0002642245
A 89.842941         NA       NA           NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show the confidence intervals associated with these values</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    95% LCI   95% UCI
Z  1.763931  2.810071
A 82.863012 93.979931</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the points with the results for Z and A</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Portfolio_6_FSA_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Weighted Regression</p>
<p>The use of catchCurve in the previous chunk assigned equal weight to fish of all ages, but Maceina and Bettoli (1998) suggested that a weighted regression should be used with the catch-curve method in order to reduce the relative impact of older ages with fewer fish. The use of use.weights=TRUE satisfies this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>weighted_results <span class="ot">&lt;-</span> FSA<span class="sc">::</span><span class="fu">catchCurve</span>(catch<span class="sc">~</span>age,<span class="at">data=</span>data,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ages2use=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>,<span class="at">use.weights=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weighted_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Estimate Std. Error  t value     Pr(&gt;|t|)
Z  2.596582 0.09096301 28.54548 9.439381e-05
A 92.547214         NA       NA           NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(weighted_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    95% LCI   95% UCI
Z  2.307097  2.886067
A 90.045022 94.420479</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weighted_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Portfolio_6_FSA_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="portfolio-question" class="level2">
<h2 class="anchored" data-anchor-id="portfolio-question">Portfolio Question:</h2>
<p>How do the estimates of Z and A change between between the weighted and non-weighted regressions? How does the confidence interval change?</p>
</section>
</section>
<section id="non-weighted-results" class="level1">
<h1>Non-weighted Results:</h1>
<p>Z estimate: 2.287001 A estimate: 89.842941</p>
<p>Confidence Interval: 95% LCI 95% UCI Z 1.763931 2.810071 A 82.863012 93.979931</p>
</section>
<section id="weighted_results" class="level1">
<h1>Weighted_Results:</h1>
<p>Z estimate: 2.596582 A estimate: 92.547214</p>
<p>Confidence Interval: 95% LCI 95% UCI Z 2.307097 2.886067 A 90.045022 94.420479</p>
<section id="answer-the-estimates-of-z-and-a-both-increase-with-the-weighted-results.-z-increases-by-about-.3-and-a-increases-by-about-3.7.-the-results-of-the-weighted-output-are-closer-to-the-95-confidence-interval.-the-values-for-the-confidence-interval-increase-from-the-non-weighted-results-to-the-weighted-results." class="level2">
<h2 class="anchored" data-anchor-id="answer-the-estimates-of-z-and-a-both-increase-with-the-weighted-results.-z-increases-by-about-.3-and-a-increases-by-about-3.7.-the-results-of-the-weighted-output-are-closer-to-the-95-confidence-interval.-the-values-for-the-confidence-interval-increase-from-the-non-weighted-results-to-the-weighted-results.">Answer: The estimates of Z and A both increase with the weighted results. Z increases by about .3 and A increases by about 3.7. The results of the weighted output are closer to the 95% confidence interval. The values for the confidence interval increase from the non-weighted results to the weighted results.</h2>
<section id="section-2" class="level70">
<p class="heading"></p>
</section>
</section>
<section id="depletion-example" class="level2">
<h2 class="anchored" data-anchor-id="depletion-example">Depletion example</h2>
<p>Welcome to the FSA function depletion()!!!!</p>
<p>This function can be used to estimate the initial population size (N0) for a closed population (aka no immigration, emmigration, mortatlity, or recruitment).</p>
<p>There are three methods for estimating N0: the Leslie Method, DeLury Method, and K-Pass Method</p>
<p>load in the depletion data!</p>
<p>If you go to the help window and click on the depletion package, you will also find details about the Leslie and DeLury methods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help.search</span>(<span class="st">"depletion"</span>, <span class="at">package=</span><span class="fu">c</span>(<span class="st">"FSAdata"</span>,<span class="st">"FSA"</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#we are going to use the catch and effort snapper data </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#there are 3 different species within this data set, all with the same effort. We are going to focus on Pristipomoides zonatus species. </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#effort = fishing effort (line-hours of a bottom hand-line)</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>snapper <span class="ot">&lt;-</span> FSAdata<span class="sc">::</span>Pathfinder</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>snapper_pzonatus <span class="ot">&lt;-</span>snapper <span class="sc">%&gt;%</span> <span class="fu">clean_names</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now to start with the Leslie Method!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#grab the data use the depletion() to calculate N0 and q</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>leslie <span class="ot">&lt;-</span> <span class="fu">with</span>(snapper_pzonatus, <span class="fu">depletion</span>(pzonatus,effort,<span class="at">method=</span><span class="st">"Leslie"</span>,<span class="at">Ricker.mod =</span> <span class="cn">TRUE</span>)) <span class="co">#the ricker.mod is a modification that is used within the equation</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(leslie) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate    Std. Err.
No 1.065655e+03 1.222561e+02
q  3.825263e-03 7.228298e-04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remember that N0 = initial population size and q = catchability coefficient or the fraction of the population that is removed by one unit of fishing effort</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#find the confidence intervals of this data</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(leslie)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        95% LCI      95% UCI
No 7.965712e+02 1334.7388379
q  2.234325e-03    0.0054162</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot it</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(leslie)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Portfolio_6_FSA_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The initial population size of the Pristipomoides zonatus is 1066.</p>
<p>Now for the DeLury Method!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we will use the same set of data and species for this method in order to compare/contrast them</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>delury <span class="ot">&lt;-</span> <span class="fu">with</span>(snapper_pzonatus, <span class="fu">depletion</span>(pzonatus, effort, <span class="at">method=</span><span class="st">"Delury"</span>, <span class="at">Ricker.mod =</span> <span class="cn">TRUE</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(delury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate    Std. Err.
No 1.077473e+03 9.546703e+01
q  3.630042e-03 6.091467e-04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(delury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        95% LCI      95% UCI
No 8.673516e+02 1.287595e+03
q  2.289319e-03 4.970765e-03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(delury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Portfolio_6_FSA_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The DeLury Method finds that the inital population size of Pristipomoides zonatus is 1077, so 11 more than the Leslie Method as well as a slight decrease in q!</p>
<p>Now for the K-Pass Method</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#again, we are going to use the snapper Pristipomoides zonatus data, but this time we only need catch data</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#for this method, we will still get N0 but will also get p which is probability of capture</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>k_pass <span class="ot">&lt;-</span> <span class="fu">with</span>(snapper_pzonatus, <span class="fu">removal</span>(pzonatus)) </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k_pass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Estimate Std. Error
No 985.0000000 46.9545217
p    0.1018391  0.0092476</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(k_pass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       95% LCI      95% UCI
No 892.9708286 1077.0291714
p    0.0837141    0.1199642</code></pre>
</div>
</div>
<p>The K-Pass Method determined that N0 is 985, but does have an upper bound of 1077. p=0.1</p>
</section>
<section id="portfolio-questions" class="level2">
<h2 class="anchored" data-anchor-id="portfolio-questions">Portfolio Questions:</h2>
<p>Grab a new set of data and use the Leslie, DeLury, and K-Pass methods to calculate the initial population size! Answer the following questions:</p>
<ol type="1">
<li>Compare and contrast the initial population sizes between the three methods</li>
</ol>
<ul>
<li>Leslie: No = 1066</li>
<li>DeLury: No = 1077</li>
<li>K-Pass: No = 985</li>
</ul>
</section>
<section id="answer-leslie-and-delury-had-relatively-similar-no-population-sizes-whereas-k-pass-estimated-a-much-smaller-initial-population-size.-the-initial-population-size-from-the-delury-method-was-the-highest-of-the-three." class="level2">
<h2 class="anchored" data-anchor-id="answer-leslie-and-delury-had-relatively-similar-no-population-sizes-whereas-k-pass-estimated-a-much-smaller-initial-population-size.-the-initial-population-size-from-the-delury-method-was-the-highest-of-the-three.">Answer: Leslie and DeLury had relatively similar No population sizes, whereas K-Pass estimated a much smaller initial population size. The initial population size from the DeLury method was the highest of the three.</h2>
<ol start="2" type="1">
<li>Why are the Leslie and DeLury methods not valid at estimating N0?</li>
</ol>
</section>
<section id="answer-the-delury-and-leslie-methods-are-not-valif-at-esimtaing-no-beucase-they-have-much-larger-standard-error-and-confidence-interval-than-the-k-pass-method.-in-addition-they-are-not-valid-for-estimating-population-size-because-both-methods-assume-a-constant-population-growth-rate.-due-to-this-they-are-not-valid-at-estimating-no-becuase-it-does-not-account-for-variability-in-growth-rates-over-time-such-as-thsoe-driven-by-environmental-events-etc." class="level2">
<h2 class="anchored" data-anchor-id="answer-the-delury-and-leslie-methods-are-not-valif-at-esimtaing-no-beucase-they-have-much-larger-standard-error-and-confidence-interval-than-the-k-pass-method.-in-addition-they-are-not-valid-for-estimating-population-size-because-both-methods-assume-a-constant-population-growth-rate.-due-to-this-they-are-not-valid-at-estimating-no-becuase-it-does-not-account-for-variability-in-growth-rates-over-time-such-as-thsoe-driven-by-environmental-events-etc.">Answer: The Delury and Leslie methods are not valif at esimtaing NO beucase they have much larger standard error and confidence interval than the K-Pass method. In addition, they are not valid for estimating population size because both methods assume a constant population growth rate. Due to this, they are not valid at estimating NO becuase it does not account for variability in growth rates over time such as thsoe driven by environmental events, etc.</h2>
<ol start="3" type="1">
<li>What values can you look at to determine the reliability of the data? (Hint: Think back to what we learned about statistics in 206)</li>
</ol>
</section>
<section id="answer-we-can-look-at-the-standard-error-and-the-confidence-intervals-from-the-model-output-to-inform-model-reliability-of-the-data.-prior-to-running-models-visualize-the-data-to-get-a-better-idea-of-visual-data-trends-before-running-models---this-will-help-to-understand-the-model-outputs-later." class="level2">
<h2 class="anchored" data-anchor-id="answer-we-can-look-at-the-standard-error-and-the-confidence-intervals-from-the-model-output-to-inform-model-reliability-of-the-data.-prior-to-running-models-visualize-the-data-to-get-a-better-idea-of-visual-data-trends-before-running-models---this-will-help-to-understand-the-model-outputs-later.">Answer: We can look at the standard error and the confidence intervals from the model output to inform model reliability of the data. Prior to running models, visualize the data to get a better idea of visual data trends before running models - this will help to understand the model outputs later.</h2>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>